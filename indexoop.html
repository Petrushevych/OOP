<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>OOP Hl√≠dky FIVEPD</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      height: 100vh;
      width: calc(100% - 220px);
      float: left;
    }
  #hlidky-panel {
    position: fixed;
    top: 80px;
    right: 0;
    width: 220px;
    background: #f5f5f5;
    border-left: 2px solid #ccc;
    padding: 15px;
    z-index: 999;
    font-size: 1em;
    box-shadow: -2px 0 5px rgba(0,0,0,0.1);
    display: block; /* ‚Üê Tohle je kl√≠ƒçov√© */
  }
    #hlidky-tabulka {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    #hlidky-tabulka th, #hlidky-tabulka td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #hlidky-tabulka th {
      background-color: #eee;
      font-weight: bold;
    }
    .barva-editor select {
  width: 100%;
  padding: 4px;
}
#admin-controls button {
  width: 100%;
  padding: 10px;
  background-color: #1976d2;
  color: white;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

    .modra {
  background-color: #1565c0;
  color: white;
}
.cervena {
  background-color: #c62828;
  color: white;
}
.zluta {
  background-color: #fdd835;
  color: black;
}
.fialova {
  background-color: #6a1b9a;
  color: white;
}

    .hlidka {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      font-weight: bold;
      background-color: #2e7d32;
      color: white;
    }
    #heslo-box {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #popup-msg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 20px 30px;
  font-size: 1.2em;
  font-weight: bold;
  border-radius: 8px;
  z-index: 2000;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  text-align: center;
  animation: fadein 0.3s ease;
}
.popup-error {
  background-color: #c62828;
  color: white;
}
.popup-success {
  background-color: #2e7d32;
  color: white;
}
@keyframes fadein {
  from { opacity: 0; }
  to { opacity: 1; }
}
  </style>
</head>
<body>

  <div id="heslo-box">
    <label>Zadej heslo spr√°vce:</label>
    <input type="password" id="heslo">
    <button onclick="overitHeslo()">Odemknout</button>
  </div>

<div id="hlidky-panel">
  <h2>üëÆ Hl√≠dky OOP</h2>
<table id="hlidky-tabulka">
  <thead>
    <tr>
      <th>Volac√≠ znak</th>
      <th class="barva-editor" style="display:none;">Barva</th>
    </tr>
  </thead>
  <tbody>
    <!-- ≈ò√°dky se generuj√≠ automaticky -->
  </tbody>
</table>

  <div id="admin-controls" style="display:none; margin-top:10px;">
    <button onclick="ulozitAOdhlasit()">üíæ Ulo≈æit a odhl√°sit</button>
  </div>
</div>

  <div id="map"></div>
  <div id="popup-msg" style="display:none;"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCTmQI32kkdzPKOV_arZ4OVrcuvMBfzBMM",
    authDomain: "oophlidky.firebaseapp.com",
    databaseURL: "https://oophlidky-default-rtdb.firebaseio.com",
    projectId: "oophlidky",
    storageBucket: "oophlidky.firebasestorage.app",
    messagingSenderId: "103016091145",
    appId: "1:103016091145:web:09c790383f5d2854b0f2d8"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let prihlaseny = false;

function overitHeslo() {
  const heslo = document.getElementById("heslo").value;
if (heslo === "OOPFIVEPDVEL254") {
  prihlaseny = true;
  document.getElementById("heslo-box").style.display = "none";
  document.querySelectorAll(".barva-editor").forEach(el => el.style.display = "table-cell");
  document.getElementById("admin-controls").style.display = "block";
  zobrazPopup("‚úÖ P≈ôihl√°≈°en√≠ spr√°vce aktivov√°no", "success");
} else {
  zobrazPopup("‚õî ≈†patn√© heslo", "error");
}
}

function zmenBarvu(select, znak) {
  const novaBarva = select.value;
  const tr = select.closest("tr");
  tr.className = novaBarva;

  db.ref("hlidky/" + znak + "/barva").set(novaBarva);
}

function ulozitAOdhlasit() {
  zobrazPopup("‚úÖ Zmƒõny ulo≈æeny. Odhl√°≈°eno.", "success");
  setTimeout(() => location.reload(), 3000);
}

function zobrazPopup(text, typ) {
  const popup = document.getElementById("popup-msg");
  popup.innerText = text;
  popup.className = typ === "error" ? "popup-error" : "popup-success";
  popup.style.display = "block";
  setTimeout(() => {
    popup.style.display = "none";
  }, 3000);
}


    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 2,
      zoomControl: true
    });

    const bounds = [[0,0], [1000,1000]]; // uprav podle rozmƒõr≈Ø mapa.png
    const image = L.imageOverlay('mapa.png', bounds).addTo(map);
    map.fitBounds(bounds);
    
console.log("Naƒç√≠t√°m hl√≠dky z Firebase...");

db.ref("hlidky").once("value").then(snapshot => {
  const data = snapshot.val();

  if (!data) {
    console.warn("‚ö†Ô∏è ≈Ω√°dn√° data v hlidky.");
    return;
  }

  const tbody = document.querySelector("#hlidky-tabulka tbody");
  tbody.innerHTML = "";

  for (const znak in data) {
    const { barva } = data[znak];
    const tr = document.createElement("tr");
    tr.className = barva;

    tr.innerHTML = `
      <td>${znak}</td>
      <td class="barva-editor" style="display:none;">
        <select onchange="zmenBarvu(this, '${znak}')">
          <option value="modra" ${barva === "modra" ? "selected" : ""}>Modr√°</option>
          <option value="cervena" ${barva === "cervena" ? "selected" : ""}>ƒåerven√°</option>
          <option value="zluta" ${barva === "zluta" ? "selected" : ""}>≈Ωlut√°</option>
          <option value="fialova" ${barva === "fialova" ? "selected" : ""}>Fialov√°</option>
        </select>
      </td>
    `;
    tbody.appendChild(tr);
  }
});

</script>
</body>
</html>
